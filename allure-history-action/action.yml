name: 'Allure Report with history'
description: 'Generate Allure Report with history'
inputs:
  allure_results:
    description: 'Allure test result data dir'
    required: true
    default: 'allure-results'
  allure_report:
    description: 'Allure report target dir'
    required: true
    default: 'allure-report'
  branch:
    description: 'Branch of GitHub Pages'
    required: true
    default: 'gh-pages'
runs:
  using: "composite"
  steps:
    - name: Get Allure history
      uses: actions/checkout@v2
      if: always()
      continue-on-error: true
      with:
        ref: ${{ inputs.branch }}
        path: gh-pages

    - name: Test local action
      uses: ./allure-report-action
      if: always()
      #id: allure-report
      with:
        allure_results: ${{ inputs.allure-results }}
        allure_report: allure-report

    - name: Deploy report to Github Pages
      if: always()
      uses: peaceiris/actions-gh-pages@v2
      env:
        PERSONAL_TOKEN: ${{ secrets.ACCESS_TOKEN }}
        PUBLISH_BRANCH: ${{ inputs.branch }}
        PUBLISH_DIR: allure-report